<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>문의 게시판</title>
 <link rel="stylesheet" href="common.css">
  <style>
    body { font-family: Arial, sans-serif; }
    .inquiry-item { margin-bottom: 20px; border: 1px solid #ddd; padding: 10px; }
    .inquiry-item p { margin: 5px 0; }
    #inquiry-form { margin: 20px 0; }
    textarea { width: 100%; height: 100px; margin-bottom: 10px; }
    button { padding: 10px 15px; background-color: #007BFF; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #0056b3; }
  </style>
</head>
<body>
  <header>
    <h1>문의 게시판</h1>
  </header>

  <!-- 로그인 상태 확인 영역 -->
  <section id="login-check"></section>

  <!-- 문의 작성 폼 -->
  <section id="inquiry-form" style="display: none;">
    <textarea id="inquiry-text" placeholder="문의 내용을 입력하세요."></textarea>
    <button onclick="submitInquiry()">문의하기</button>
  </section>

  <!-- 문의 리스트 -->
  <section id="inquiries"></section>

  <script>
    // 로그인 상태 확인
    async function checkLoginStatus() {
      const response = await fetch('/auth/checkLogin.jsp');
      const result = await response.json();
      const loginCheck = document.getElementById('login-check');
      const inquiryForm = document.getElementById('inquiry-form');

      if (result.loggedIn) {
        loginCheck.innerHTML = `<p>안녕하세요, ${result.username}님!</p>`;
        inquiryForm.style.display = 'block';
      } else {
        loginCheck.innerHTML = `
          <p>로그인 후 문의 게시판을 이용할 수 있습니다.</p>
          <a href="/login.jsp">로그인</a>
        `;
        inquiryForm.style.display = 'none';
      }
    }

    // 문의 등록
    async function submitInquiry() {
      const text = document.getElementById('inquiry-text').value;

      const response = await fetch('/inquiry/submitInquiry.jsp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });

      const result = await response.json();
      if (result.success) {
        alert('문의가 등록되었습니다.');
        loadInquiries();
      } else {
        alert(result.message || '문의 등록에 실패했습니다.');
      }
    }

    // 문의 리스트 로드
    async function loadInquiries() {
      const response = await fetch('/inquiry/getInquiries.jsp');
      const inquiries = await response.json();
      const inquiriesDiv = document.getElementById('inquiries');

      inquiriesDiv.innerHTML = '';
      inquiries.forEach(inquiry => {
        const div = document.createElement('div');
        div.className = 'inquiry-item';
        div.innerHTML = `
          <p><strong>문의 내용:</strong> ${inquiry.text}</p>
          <p><strong>등록 시간:</strong> ${inquiry.created_at}</p>
          <p>${inquiry.answer ? `<strong>답변:</strong> ${inquiry.answer}` : '<strong>답변:</strong> 답변 대기 중'}</p>
          <p>${inquiry.answer_at ? `<strong>답변 등록 시간:</strong> ${inquiry.answer_at}` : ''}</p>
        `;
        inquiriesDiv.appendChild(div);
      });
    }

    // 초기 실행
    window.onload = () => {
      checkLoginStatus();
      loadInquiries();
    };
  </script>
</body>
</html>